<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manila Rail Commute</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #f9fafb;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 1.5rem;
    }
    select, button {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'><path d='M6 9l6 6 6-6'/></svg>");
      background-repeat: no-repeat;
      background-position: right 0.5rem center;
      background-size: 1rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">Manila Rail Commute</h2>
    <div class="mb-4">
      <label for="start" class="block text-sm font-medium text-gray-700">Start Station</label>
      <select id="start" class="w-full p-2.5 border border-gray-300 rounded-md bg-white text-gray-900 focus:ring-2 focus:ring-blue-500">
        <option value="">Select Start Station</option>
      </select>
    </div>
    <div class="mb-4">
      <label for="dest" class="block text-sm font-medium text-gray-700">Destination Station</label>
      <select id="dest" class="w-full p-2.5 border border-gray-300 rounded-md bg-white text-gray-900 focus:ring-2 focus:ring-blue-500">
        <option value="">Select Destination Station</option>
      </select>
    </div>
    <div class="mb-4">
      <label for="user-type" class="block text-sm font-medium text-gray-700">User Type</label>
      <select id="user-type" class="w-full p-2.5 border border-gray-300 rounded-md bg-white text-gray-900 focus:ring-2 focus:ring-blue-500">
        <option value="">Select User Type</option>
        <option value="Regular">Regular</option>
        <option value="Student">Student</option>
        <option value="PWD">PWD</option>
        <option value="Senior">Senior</option>
      </select>
    </div>
    <button onclick="startTracking()" class="w-full p-2.5 bg-green-600 text-white rounded-md hover:bg-green-700 focus:ring-2 focus:ring-green-500">Start Tracking</button>
    <div id="route" class="mt-4 p-4 bg-white rounded-md shadow-sm"></div>
    <div id="status" class="mt-4 p-4 bg-white rounded-md shadow-sm"></div>
  </div>

  <script>
    // Station data
    const stations = {
      'LRT1': {
        'Unified Grand Central Station': { lat: 14.6565, lon: 121.0037 },
        'Fernando Poe Jr.': { lat: 14.6575, lon: 121.0190 },
        'Balintawak': { lat: 14.6567, lon: 121.0053 },
        'Monumento': { lat: 14.6542, lon: 120.9835 },
        '5th Avenue': { lat: 14.6462, lon: 120.9803 },
        'R. Papa': { lat: 14.6362, lon: 120.9798 },
        'Abad Santos': { lat: 14.6300, lon: 120.9793 },
        'Blumentritt': { lat: 14.6227, lon: 120.9829 },
        'Tayuman': { lat: 14.6170, lon: 120.9822 },
        'Bambang': { lat: 14.6115, lon: 120.9820 },
        'Doroteo Jose': { lat: 14.6053, lon: 120.9810 },
        'Carriedo': { lat: 14.5991, lon: 120.9814 },
        'Central Terminal': { lat: 14.5930, lon: 120.9812 },
        'United Nations': { lat: 14.5821, lon: 120.9846 },
        'Pedro Gil': { lat: 14.5765, lon: 120.9882 },
        'Quirino': { lat: 14.5703, lon: 120.9915 },
        'Vito Cruz': { lat: 14.5648, lon: 120.9932 },
        'Gil Puyat': { lat: 14.5542, lon: 120.9971 },
        'Libertad': { lat: 14.5479, lon: 121.0001 },
        'EDSA': { lat: 14.5366, lon: 121.0004 },
        'Baclaran': { lat: 14.5075, lon: 120.9964 },
        'Redemptorist–Aseana': { lat: 14.5030, lon: 120.9950 },
        'MIA Road': { lat: 14.5000, lon: 120.9940 },
        'PITX': { lat: 14.5100, lon: 120.9910 },
        'Ninoy Aquino Avenue': { lat: 14.4986, lon: 120.9944 },
        'Dr. Santos': { lat: 14.4960, lon: 120.9935 },
        'Las Piñas': { lat: 14.4940, lon: 120.9925 },
        'Zapote': { lat: 14.4920, lon: 120.9915 },
        'Talaba': { lat: 14.4900, lon: 120.9905 },
        'Niog': { lat: 14.4880, lon: 120.9895 }
      },
      'LRT2': {
        'Antipolo': { lat: 14.6250, lon: 121.1200 },
        'Marikina–Pasig': { lat: 14.6200, lon: 121.1000 },
        'Santolan': { lat: 14.6104, lon: 121.0900 },
        'Katipunan': { lat: 14.6294, lon: 121.0740 },
        'Anonas': { lat: 14.6290, lon: 121.0650 },
        'Araneta Center–Cubao': { lat: 14.6223, lon: 121.0526 },
        'Betty Go-Belmonte': { lat: 14.6180, lon: 121.0470 },
        'Gilmore': { lat: 14.6137, lon: 121.0371 },
        'J. Ruiz': { lat: 14.6100, lon: 121.0300 },
        'V. Mapa': { lat: 14.6053, lon: 121.0200 },
        'Pureza': { lat: 14.6020, lon: 121.0100 },
        'Legarda': { lat: 14.6000, lon: 121.0030 },
        'Recto': { lat: 14.6033, lon: 120.9750 },
        'Tutuban': { lat: 14.6110, lon: 120.9720 },
        'Divisoria': { lat: 14.6090, lon: 120.9700 },
        'Pier 4': { lat: 14.6070, lon: 120.9680 }
      },
      'MRT3': {
        'North Avenue': { lat: 14.6514, lon: 121.0329 },
        'Quezon Avenue': { lat: 14.6433, lon: 121.0377 },
        'GMA–Kamuning': { lat: 14.6363, lon: 121.0424 },
        'Araneta Center–Cubao': { lat: 14.6195, lon: 121.0513 },
        'Santolan–Annapolis': { lat: 14.6085, lon: 121.0567 },
        'Ortigas': { lat: 14.5885, lon: 121.0572 },
        'Shaw Boulevard': { lat: 14.5816, lon: 121.0537 },
        'Boni': { lat: 14.5732, lon: 121.0480 },
        'Guadalupe': { lat: 14.5673, lon: 121.0455 },
        'Buendia': { lat: 14.5569, lon: 121.0336 },
        'Ayala': { lat: 14.5493, lon: 121.0279 },
        'Magallanes': { lat: 14.5410, lon: 121.0195 },
        'Taft Avenue': { lat: 14.5375, lon: 121.0014 }
      }
    };

    // Graph: adjacency list
    const graph = {
      'Unified Grand Central Station': ['Fernando Poe Jr.'],
      'Fernando Poe Jr.': ['Unified Grand Central Station', 'Balintawak'],
      'Balintawak': ['Fernando Poe Jr.', 'Monumento'],
      'Monumento': ['Balintawak', '5th Avenue'],
      '5th Avenue': ['Monumento', 'R. Papa'],
      'R. Papa': ['5th Avenue', 'Abad Santos'],
      'Abad Santos': ['R. Papa', 'Blumentritt'],
      'Blumentritt': ['Abad Santos', 'Tayuman'],
      'Tayuman': ['Blumentritt', 'Bambang'],
      'Bambang': ['Tayuman', 'Doroteo Jose'],
      'Doroteo Jose': ['Bambang', 'Carriedo', 'Recto'],
      'Carriedo': ['Doroteo Jose', 'Central Terminal'],
      'Central Terminal': ['Carriedo', 'United Nations'],
      'United Nations': ['Central Terminal', 'Pedro Gil'],
      'Pedro Gil': ['United Nations', 'Quirino'],
      'Quirino': ['Pedro Gil', 'Vito Cruz'],
      'Vito Cruz': ['Quirino', 'Gil Puyat'],
      'Gil Puyat': ['Vito Cruz', 'Libertad'],
      'Libertad': ['Gil Puyat', 'EDSA'],
      'EDSA': ['Libertad', 'Baclaran', 'Taft Avenue'],
      'Baclaran': ['EDSA', 'Redemptorist–Aseana'],
      'Redemptorist–Aseana': ['Baclaran', 'MIA Road'],
      'MIA Road': ['Redemptorist–Aseana', 'PITX'],
      'PITX': ['MIA Road', 'Ninoy Aquino Avenue'],
      'Ninoy Aquino Avenue': ['PITX', 'Dr. Santos'],
      'Dr. Santos': ['Ninoy Aquino Avenue', 'Las Piñas'],
      'Las Piñas': ['Dr. Santos', 'Zapote'],
      'Zapote': ['Las Piñas', 'Talaba'],
      'Talaba': ['Zapote', 'Niog'],
      'Niog': ['Talaba'],
      'Antipolo': ['Marikina–Pasig'],
      'Marikina–Pasig': ['Antipolo', 'Santolan'],
      'Santolan': ['Marikina–Pasig', 'Katipunan'],
      'Katipunan': ['Santolan', 'Anonas'],
      'Anonas': ['Katipunan', 'Araneta Center–Cubao'],
      'Araneta Center–Cubao': ['Anonas', 'Betty Go-Belmonte', 'Araneta Center–Cubao'],
      'Betty Go-Belmonte': ['Araneta Center–Cubao', 'Gilmore'],
      'Gilmore': ['Betty Go-Belmonte', 'J. Ruiz'],
      'J. Ruiz': ['Gilmore', 'V. Mapa'],
      'V. Mapa': ['J. Ruiz', 'Pureza'],
      'Pureza': ['V. Mapa', 'Legarda'],
      'Legarda': ['Pureza', 'Recto'],
      'Recto': ['Legarda', 'Tutuban', 'Doroteo Jose'],
      'Tutuban': ['Recto', 'Divisoria'],
      'Divisoria': ['Tutuban', 'Pier 4'],
      'Pier 4': ['Divisoria'],
      'North Avenue': ['Quezon Avenue'],
      'Quezon Avenue': ['North Avenue', 'GMA–Kamuning'],
      'GMA–Kamuning': ['Quezon Avenue', 'Araneta Center–Cubao'],
      'Araneta Center–Cubao': ['GMA–Kamuning', 'Santolan–Annapolis', 'Araneta Center–Cubao'],
      'Santolan–Annapolis': ['Araneta Center–Cubao', 'Ortigas'],
      'Ortigas': ['Santolan–Annapolis', 'Shaw Boulevard'],
      'Shaw Boulevard': ['Ortigas', 'Boni'],
      'Boni': ['Shaw Boulevard', 'Guadalupe'],
      'Guadalupe': ['Boni', 'Buendia'],
      'Buendia': ['Guadalupe', 'Ayala'],
      'Ayala': ['Buendia', 'Magallanes'],
      'Magallanes': ['Ayala', 'Taft Avenue'],
      'Taft Avenue': ['Magallanes', 'EDSA']
    };

    // Fare discounts
    const fareDiscounts = {
      'Regular': 1.0,
      'Student': 0.8,
      'PWD': 0.8,
      'Senior': 0.8
    };

    // Global variables
    let startStation = '';
    let destStation = '';
    let userType = '';

    // Populate dropdowns
    const allStations = [...new Set(Object.values(stations).flatMap(line => Object.keys(line)))].sort();
    const startSelect = document.getElementById('start');
    const destSelect = document.getElementById('dest');
    allStations.forEach(station => {
      const option1 = document.createElement('option');
      option1.value = station;
      option1.text = station;
      startSelect.appendChild(option1);
      const option2 = document.createElement('option');
      option2.value = station;
      option2.text = station;
      destSelect.appendChild(option2);
    });

    // Event listeners for dropdowns
    startSelect.addEventListener('change', () => startStation = startSelect.value);
    destSelect.addEventListener('change', () => destStation = destSelect.value);
    document.getElementById('user-type').addEventListener('change', () => userType = document.getElementById('user-type').value);

    // BFS for shortest path
    function findRoute(start, dest) {
      const queue = [[start]];
      const visited = new Set();
      while (queue.length) {
        const path = queue.shift();
        const node = path[path.length - 1];
        if (node === dest) return path;
        if (!visited.has(node)) {
          visited.add(node);
          for (const next of (graph[node] || [])) {
            queue.push([...path, next]);
          }
        }
      }
      return [];
    }

    // Calculate fare
    function calculateFare(route) {
      let fare = 0;
      let currentLine = null;
      let stationCount = 0;
      let transfers = 0;

      for (let i = 0; i < route.length - 1; i++) {
        const from = route[i];
        const to = route[i + 1];
        const fromLine = Object.keys(stations).find(line => stations[line][from]);
        const toLine = Object.keys(stations).find(line => stations[line][to]);

        if (fromLine !== currentLine && currentLine) transfers++;
        if (fromLine === toLine) stationCount++;
        currentLine = toLine;

        if (i === route.length - 2) {
          if (currentLine === 'LRT1' || currentLine === 'LRT2') {
            fare += 15 + Math.max(0, Math.ceil((stationCount - 4) / 4)) * 5;
          } else if (currentLine === 'MRT3') {
            fare += 13 + Math.max(0, stationCount - 4) * 3;
          }
        }
      }

      fare += transfers * 5; // PHP 5 per transfer
      return Math.round(fare * fareDiscounts[userType]);
    }

    // Haversine distance (km)
    function haversineDistance(lat1, lon1, lat2, lon2) {
      const R = 6371; // Earth radius in km
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }

    // Find closest station
    function findClosestStation(lat, lon) {
      let minDist = Infinity;
      let closest = null;
      for (const line in stations) {
        for (const station in stations[line]) {
          const { lat: sLat, lon: sLon } = stations[line][station];
          const dist = haversineDistance(lat, lon, sLat, sLon);
          if (dist < minDist) {
            minDist = dist;
            closest = station;
          }
        }
      }
      return { station: closest, distance: minDist };
    }

    // Start tracking
    function startTracking() {
      if (!startStation || !destStation || !userType) {
        alert('Please select start station, destination station, and user type');
        return;
      }
      if (!graph[startStation] || !graph[destStation]) {
        alert('Invalid station selected');
        return;
      }

      const route = findRoute(startStation, destStation);
      if (!route.length) {
        alert('No route found between the stations');
        return;
      }
      const fare = calculateFare(route);
      document.getElementById('route').innerHTML = `
        <p class="text-gray-800"><strong>Route:</strong> ${route.join(' → ')}</p>
        <p class="text-gray-800"><strong>Fare:</strong> PHP ${fare} (${userType})</p>
      `;

      if (!navigator.geolocation) {
        alert('Geolocation not supported by your browser');
        return;
      }
      navigator.geolocation.watchPosition(
        (position) => {
          const { latitude, longitude } = position.coords;
          const { station, distance } = findClosestStation(latitude, longitude);
          document.getElementById('status').innerHTML = `
            <p class="text-gray-800"><strong>Current Station:</strong> ${station}</p>
            <p class="text-gray-800"><strong>Distance:</strong> ${distance.toFixed(2)} km</p>
          `;
          if (station === destStation && distance < 0.5) {
            alert(`You are near your destination: ${destStation}!`);
            navigator.geolocation.clearWatch(this.watchId);
          }
        },
        (error) => {
          document.getElementById('status').innerHTML = '<p class="text-red-600">Location error: Please enable GPS</p>';
        },
        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
      );
    }
  </script>
</body>
</html> 